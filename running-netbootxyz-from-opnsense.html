
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
  <meta name="google-site-verification" content="ZlfC6LPbIl8QMogAf9hWUt9xNqocwt4niXcpc56reIs" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://blog.kail.io/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://blog.kail.io/theme/pygments/gruvbox-dark.min.css">



  <link rel="stylesheet" type="text/css" href="https://blog.kail.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://blog.kail.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://blog.kail.io/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="https://blog.kail.io/static/custom.css">
  <link rel="stylesheet" type="text/css" href="https://blog.kail.io/theme//copy/copy.css">

  <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon">


  <link href="https://blog.kail.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Andrew Kail's Blog Atom">




<script defer data-domain="blog.kail.io" src="https://plausible.kail.io/js/script.js"></script>




 

<meta name="author" content="Andrew Kail" />
<meta name="description" content="After working with some PXE booting at work recently, I decided to pick up a long standing todo of installing netboot.xyz on my network. When I started to take a deeper look into it I realized I could probably install it on my OPNSense VM as it is the …" />
<meta name="keywords" content="opnsense, netboot">


  <meta property="og:site_name" content="Andrew Kail's Blog"/>
  <meta property="og:title" content="Running Netboot.xyz From OPNSense"/>
  <meta property="og:description" content="After working with some PXE booting at work recently, I decided to pick up a long standing todo of installing netboot.xyz on my network. When I started to take a deeper look into it I realized I could probably install it on my OPNSense VM as it is the …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://blog.kail.io/running-netbootxyz-from-opnsense.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-03-29 01:00:00-04:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://blog.kail.io/author/andrew-kail.html">
  <meta property="article:section" content="OPNSense"/>
  <meta property="article:tag" content="opnsense"/>
  <meta property="article:tag" content="netboot"/>
  <meta property="og:image" content="https://blog.kail.io/images/profile.png">

  <title>Andrew Kail's Blog &ndash; Running Netboot.xyz From OPNSense</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="https://blog.kail.io/">
      <img src="https://blog.kail.io/images/profile.png" alt="Andrew Kail's Blog" title="Andrew Kail's Blog">
    </a>

    <h1>
      <a href="https://blog.kail.io/">Andrew Kail's Blog</a>
    </h1>

    <p>Somewhat HPC related blog</p>


    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="https://blog.kail.io/pages/about.html#about">
                About
              </a>
            </li>
            <li>
              <a target="_self"
                 href="https://blog.kail.io/pages/get-in-touch.html#get-in-touch">
                Get in Touch
              </a>
            </li>
            <li>
              <a target="_self"
                 href="https://blog.kail.io/pages/projects.html#projects">
                Projects
              </a>
            </li>

          <li>
            <a target="_self" href="https://github.com/akail/Configs" >My Configs</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="https://github.com/akail"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="/feeds/all.atom.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/andrewkail/"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://fosstodon.org/@akail"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://blog.kail.io/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>

  <a href="https://blog.kail.io/feeds/all.atom.xml">Atom</a>

</nav>

<article class="single">
  <header>
      
    <h1 id="running-netbootxyz-from-opnsense">Running Netboot.xyz From OPNSense</h1>
    <p>
      Posted on Wed 29 March 2023 in <a href="https://blog.kail.io/category/opnsense.html">OPNSense</a>

    </p>
  </header>


  <div>
    <p>After working with some PXE booting at work recently, I decided to pick up a
long standing todo of installing netboot.xyz on my network.  When I started to
take a deeper look into it I realized I could probably install it on my OPNSense
VM as it is the DHCP server and comes with a TFTP plugin.</p>
<h2>Install TFTP</h2>
<p>The first thing we need to do is install the TFTP plugin.  One note about this
plugin is that it is no longer maintained so there is a possibility it may go
away in the future.  Hopefully that is not the case.</p>
<p>Navigate to <code>System &gt; Firmware &gt; Plugins</code> and search for <code>os-tftp</code>, then click
the <code>+</code> button to install the plugin.</p>
<p><img alt="Install TFTP Plugin" src="https://blog.kail.io/images/2023/opnsense-pxe/opnsense-pxe-1.png"></p>
<p>Once we have the plugin installed we'll need to create the tftp directory and
install netboot before enabling the service.  Otherwise it will fail. This step
requires ssh access.</p>
<div class="highlight"><pre><span></span><code><span class="n">ssh</span><span class="w"> </span><span class="n">root</span><span class="err">@</span><span class="n">opnsense</span>

<span class="c1"># Select &#39;8&#39; at the menu to enter the shell</span>

<span class="n">mkdir</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">tftp</span>
<span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">tftp</span>

<span class="c1"># Download netboot files</span>
<span class="n">fetch</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">boot</span><span class="o">.</span><span class="n">netboot</span><span class="o">.</span><span class="n">xyz</span><span class="o">/</span><span class="n">ipxe</span><span class="o">/</span><span class="n">netboot</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">kpxe</span>
<span class="n">fetch</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">boot</span><span class="o">.</span><span class="n">netboot</span><span class="o">.</span><span class="n">xyz</span><span class="o">/</span><span class="n">ipxe</span><span class="o">/</span><span class="n">netboot</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">efi</span>
<span class="n">fetch</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">boot</span><span class="o">.</span><span class="n">netboot</span><span class="o">.</span><span class="n">xyz</span><span class="o">/</span><span class="n">ipxe</span><span class="o">/</span><span class="n">netboot</span><span class="o">.</span><span class="n">xyz</span><span class="o">-</span><span class="n">arm64</span><span class="o">.</span><span class="n">efi</span>
</code></pre></div>

<p>I downloaded three files above to support the main types of network booting I
expect on my home network.  Namely Bios, EFI, and ARM EFI.  If you feel you need
to use a different bootloader you'll want to read the netboot documenation for
that.</p>
<p>Now we can enable the service, making sure to set the "Listen Address" to the ip
we expect to boot from. </p>
<p><img alt="Enalbe TFTP" src="https://blog.kail.io/images/2023/opnsense-pxe/opnsense-pxe-2.png"></p>
<p>Click save and make sure the TFTP service has properly started.  You should see
a green play button in the top right indicating the service is running.</p>
<h2>Configure DHCP</h2>
<p>Now we need to enable the dhcp server to allow network booting.</p>
<p>Navigate to <code>Services &gt; DHCPv4 &gt; [Name of you boot network]</code>.  Making sure to
select the network you wish to boot from.  In my case, its my Internal network.</p>
<p><img alt="Configure Network Booting" class="center-img" src="https://blog.kail.io/images/2023/opnsense-pxe/opnsense-pxe-3.png" width="300"></p>
<p>Scroll down till you see  <code>Network Booting</code> and click the <code>Advanced</code> button to
show all the full settings.</p>
<p><img alt="Advanced Settings" src="https://blog.kail.io/images/2023/opnsense-pxe/opnsense-pxe-4.png"></p>
<p>Fill out the form with the IP Address we configured for the TFTP service.  For
the filenames, you can do the following:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td>bios</td>
<td>netboot.xyz.kpxe</td>
</tr>
<tr>
<td>x86 UEFI (32-bit)</td>
<td>netboot.xyz.efi</td>
</tr>
<tr>
<td>x86 UEFI (64-bit)</td>
<td>netboot.xyz.efi</td>
</tr>
<tr>
<td>ARM x86 UEFI (32-bit)</td>
<td>netboot.xyz-arm64.efi</td>
</tr>
<tr>
<td>ARM x86 UEFI (64-bit)</td>
<td>netboot.xyz-arm64.efi</td>
</tr>
</tbody>
</table>
<p><img alt="Boot Filenames" src="https://blog.kail.io/images/2023/opnsense-pxe/opnsense-pxe-5.png"></p>
<p>Scrool down to click save and the DHCP service should restart.  Now when you do
network booting with a system on the network it will bring up a slick menu to
boot your favorite distribution.</p>
<h2>References</h2>
<ul>
<li><a href="https://netboot.xyz/docs/booting/tftp">Netboot.xyz</a></li>
<li><a href="https://www.reddit.com/r/OPNsenseFirewall/comments/zx86ve/how_to_configure_opnsense_for_netbootxyz/">Reddit
Thread</a></li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://blog.kail.io/tag/opnsense.html">opnsense</a>
      <a href="https://blog.kail.io/tag/netboot.html">netboot</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy;   - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Andrew Kail's Blog ",
  "url" : "https://blog.kail.io",
  "image": "https://blog.kail.io/images/profile.png",
  "description": "The personal blog of Andrew Kail, an HPC enthusiast, PhD Student, and homelaber."
}
</script>
  <script src="https://blog.kail.io/theme/copy/copy.js"></script>
</body>
</html>